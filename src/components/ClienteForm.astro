---
---
<div class="form">
  <div class="form-grid">
    <label>
      Nombre Cliente:
      <input id="nombreCliente" type="text" />
    </label>

    <label>
      Teléfono Cliente:
      <input id="telefono" type="text" />
    </label>

    <label>
      Correo Cliente:
      <input id="email" type="email" />
    </label>

    <label>
      Estado del cliente
      <select id="estadoCliente">
        <option value="true">Activo</option>
        <option value="false">Inactivo</option>
      </select>
    </label>

    <label>
      Tipo de cliente
      <select id="tipoCliente">
        <option value="normal">Normal</option>
        <option value="deudor">Deudor</option>
      </select>
    </label>

    <label>
      Fecha creación
      <input id="fecha" type="date" />
    </label>

    <div class="actions-left">
      <button id="btn-cancelarCliente" type="button" class="btn cancel">
        CANCELAR
      </button>
      <button id="btn-guardarCliente" type="button" class="btn save">
        GUARDAR
      </button>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {

  const nombreCliente = document.getElementById('nombreCliente') as HTMLInputElement;
  const telefono = document.getElementById('telefono') as HTMLInputElement;
  const email = document.getElementById('email') as HTMLInputElement;
  const estadoCliente = document.getElementById('estadoCliente') as HTMLSelectElement;
  const tipoCliente = document.getElementById('tipoCliente') as HTMLSelectElement;
  const fecha = document.getElementById('fecha') as HTMLInputElement;

  const guardarCliente = document.getElementById('btn-guardarCliente') as HTMLButtonElement;
  const cancelarCliente = document.getElementById('btn-cancelarCliente') as HTMLButtonElement;

  guardarCliente.addEventListener('click', async () => {

    const fechaInput = fecha.value
    ? new Date(fecha.value).toISOString()
    : new Date().toISOString();
    const payload = {
      nombre: nombreCliente.value.trim(),
      telefono: telefono.value.trim(),
      email: email.value.trim(),
      tipo: tipoCliente.value,
      estado: estadoCliente.value === 'true',
      fecha_creacion: fechaInput
        ? new Date(fechaInput).toISOString()
        : new Date().toISOString()
    };

    if (!payload.nombre) {
      alert('El nombre del cliente es obligatorio');
      return;
    }

    try {
      const res = await fetch(
        'https://localhost:44313/Api/Cliente',
        //'https://apioper.legumfrutsa.com/Api/Clientes/one',
        {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        }
      );

      const text = await res.text();
      if (!res.ok) throw new Error(text);

      alert('Cliente registrado correctamente');
      limpiarFormulario();

      // notificar a la tabla
      window.dispatchEvent(new CustomEvent('cliente-creado'));

    } catch (err) {
      console.error(err);
      alert('No se pudo registrar el cliente');
    }
  });

  cancelarCliente.addEventListener('click', limpiarFormulario);

  function limpiarFormulario() {
    nombreCliente.value = '';
    telefono.value = '';
    email.value = '';
    fecha.value = '';
    estadoCliente.selectedIndex = 0;
    tipoCliente.selectedIndex = 0;
  }

});
</script>
